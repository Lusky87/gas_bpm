<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ page import="com.hncis.common.util.*"%>
<%@ include file="/hncis/include/common_sub.gas"%>
<%
	String menuId = "XRM01";
	String M_DOC_NO = StringUtil.replaceParameter(StringUtil.isNullToString(request.getParameter("hid_doc_no")).trim());
	String M_REQ_YMD = StringUtil.replaceParameter(StringUtil.isNullToString(request.getParameter("hid_req_ymd")).trim());
	String M_ROOM_PLANT = StringUtil.replaceParameter(StringUtil.isNullToString(request.getParameter("hid_room_plant")).trim());
	String hid_csrfToken  = StringUtil.replaceParameter(StringUtil.isNullToString(request.getParameter("hid_csrfToken")));
	String hid_cond 	  = StringUtil.replaceParameter(StringUtil.isNullToString(request.getParameter("hid_cond")));
	String hid_view_nm    = StringUtil.replaceParameter(StringUtil.isNullToString(request.getParameter("hid_view_nm")));


	String yy = CurrentDateTime.getDate().substring(0, 4);
	String mm = CurrentDateTime.getDate().substring(4, 6);
	String dd = CurrentDateTime.getDate().substring(6, 8);

	String yymmdd = yy + "-" + mm + "-" + dd;

	String strNew = JSPMessageSource.getMessage("BUTTON.NEW",locale);
	String strSch = JSPMessageSource.getMessage("BUTTON.SEARCH",locale);
	String strSav = JSPMessageSource.getMessage("BUTTON.SAVE",locale);
	String strDel = JSPMessageSource.getMessage("BUTTON.DELETE",locale);
	String strReq = JSPMessageSource.getMessage("BUTTON.REQUEST",locale);
	String strRqc = JSPMessageSource.getMessage("BUTTON.REQUESTCANCEL",locale);
	String strCfm = JSPMessageSource.getMessage("BUTTON.CONFIRM",locale);
	String strCfc = JSPMessageSource.getMessage("BUTTON.CONFIRMCANCEL",locale);
	String strPrn = JSPMessageSource.getMessage("BUTTON.PRINT",locale);
	String strBck = JSPMessageSource.getMessage("BUTTON.BACK",locale);

	String strBtn = "";
	//strBtn = strNew+"/new@"+strSch+"/search@"+strSav+"/save@"+strDel+"/delete@"+strReq+"/request@"+strRqc+"/requestCancel@"+strCfm+"/confirm@"+strCfc+"/reject";
	strBtn = strNew+"/new@"+strSch+"/search@"+strSav+"/save@"+strDel+"/delete@"+strReq+"/request@"+strRqc+"/requestCancel";
	if(!"".equals(M_DOC_NO)){
		strBtn += "@목록/back";
	}
	String approveStepLevel = CommonGasc.getApproveStepLevel(menuId, request);
	String tempPath     = request.getServletPath().toString();
	String stepHelpUrl  = StringUtil.getStepHelp(tempPath);
%>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>회의실</title>
	</head>
	<body>
		<div id="wrap">
		<form name="frm" id="frm">
			<input type="hidden" id="initYn" value="N">
			<input type="hidden" id="M_DOC_NO" value="<%=M_DOC_NO%>">
			<input type="hidden" id="M_REQ_YMD" value="<%=M_REQ_YMD%>">
			<input type="hidden" id="M_ROOM_PLANT" value="<%=M_ROOM_PLANT%>">
			<input type="hidden" id="pgs_st_cd">
			<input type="hidden" id="ipe_eeno">
			<input type="hidden" id="if_id">
			<input type="hidden" id="room_place_h">
			<input type="hidden" id="room_meal_h">
			<input type="hidden" id="hid_cond" name="hid_cond" value="<%=hid_cond%>">
			<input type="hidden" id="hid_view_nm" name="hid_view_nm" value="<%=hid_view_nm%>">
			<input type="hidden" id="po_no" name="po_no">
			<input type="hidden" id="yymmdd" value="<%=yymmdd%>">
			<input type="hidden" id="approveStepLevel" value="<%=approveStepLevel%>">
			<input type="hidden" id="help_url" name="help_url" value="<%=stepHelpUrl%>">
			<%@ include file="../include/hncis_header.gas"%>
	        <div id="contents_wrap">
	        	<%@ include file="../include/hncis_left.gas"%>
	            <div id="contents">
					<%=CommonGasc.getTitleAndButtonNew(
						sess_empno
						,"XRM01"
						,strBtn
						,""
						,""
						,null
						,"N"
						,request)
					%>
					<div class="search_area" style="margin-bottom: 10px;">
						<table>
							<tr>
								<th width="50px"><fmt:message key="month_day"/></th>
								<td width="150px">
									<input id="req_ymd" type="text" style="width:130px" value="<%=yymmdd%>" readonly>
								</td>
								<th width="50px"><fmt:message key="region"/></th>
								<td>
									<select id="room_plant" name="room_plant" style="width:120px" onchange="setFormClear();searchRoomPlaceComb();">
								</select>
								</td>
							</tr>
						</table>
					</div>
					<table id="htmlTable" class="scroll"></table>
					<div id="htmlPager" class="scroll" style="display:none"></div>
					<div class="con_t_area">
	                	<h3><fmt:message key="basic_info"/></h3>
	                </div>
					<div class="search_area">
						<table>
							<colgroup>
								<col style="width:80px">
								<col style="width:160px">
								<col style="width:80px">
								<col style="width:160px">
								<col style="width:80px">
								<col style="width:160px">
								<col style="width:80px">
								<col style="width:160px">
							</colgroup>
							<tr>
								<th><fmt:message key="eeno"/></th>
								<td>
									<input type="text" id="req_eeno" name="req_eeno" style="width:145px;ime-mode:disabled;" onkeyup="setInsaInfo();" value="<%=sess_empno %>" class="disabled">
								</td>
								<th><fmt:message key="eenm"/></th>
								<td>
									<input type="text" id="eeno_nm" name="eeno_nm" style="width:145px;" class="disabled" readonly/>
								</td>
								<th><fmt:message key="position"/></th>
								<td>
									<input type="text" id="pos_nm" name="pos_nm" style="width:145px;" class="disabled" readonly/>
								</td>
								<th><fmt:message key="dept_nm"/></th>
								<td>
									<input type="text" id="dept_nm" name="dept_nm" style="width:145px;" class="disabled" readonly/>
								</td>
							</tr>
							<tr>
								<th><fmt:message key="req_ymd"/></th>
								<td>
									<input type="text" id="ptt_ymd" name="ptt_ymd" style="width:145px;" class="disabled" readonly/>
								</td>
								<th><fmt:message key="doc_no"/></th>
								<td>
									<input type="text" id="doc_no" name="doc_no" style="width:145px;" class="disabled" readonly/>
								</td>
								<th><fmt:message key="pgs_st_nm"/></th>
								<td>
									<input type="text" id="pgs_st_nm" name="pgs_st_cd_d" style="width:145px;" class="disabled" readonly/>
								</td>
								<th><fmt:message key="tel_no"/></th>
								<td>
									<input type="text" id="tel_no" name="tel_no" style="width:145px;" class="disabled" readonly/>
								</td>
							</tr>
							<tr style="display: none;">
								<th><fmt:message key="rtn_rsn"/></th>
								<td colspan="7">
									<input type="text" id="snb_rson_sbc" name="snb_rson_sbc" style="width:875px" class="disabled" readOnly/>
								</td>
							</tr>
						</table>
					</div>
					<div class="con_t_area">
	                	<h3><fmt:message key="req_info"/></h3>
	                </div>
					<div class="search_area">
						<table>
							<colgroup>
								<col style="width:70px;" />
	                            <col style="width:220px;" />
	                            <col style="width:75px;" />
	                            <col style="width:120px;" />
	                            <col style="width:80px;" />
	                            <col style="width:170px;" />
	                            <col style="width:80px;" />
	                            <col style="width:auto;" />
							</colgroup>
							<tr>
								<th id="tr_nm1"><fmt:message key="place"/></th>
								<td>
									<select id="room_place" name="room_place" style="width:210px" onchange="changePlaceComb();" class="req-data">
									</select>
								</td>
								<th><fmt:message key="long_tm"/></th>
								<td>
									<input type="checkbox" id="isMulti" name="isMulti" style="vertical-align: center;margin-right: 5px;">
									<select id="rsvt_day" name="rsvt_day" style="width:70px" disabled onchange="longTermCheck();"></select>
								</td>
								<th id="tr_nm2"><fmt:message key="rsvt_tm"/></th>
								<td colspan="3">
									<input id="fr_ymd" type="text" style="width:90px;" value="<%=yymmdd%>" readonly/>
									<select id="fr_time" name="fr_time" style="width:85px" onChange="fnChkApplyReqsYmd();">
									</select>
									~<input id="to_ymd" type="text" style="width:90px;" value="<%=yymmdd%>" readonly/>
									<select id="to_time" name="to_time" style="width:85px" onChange="fnChkApplyReqsYmd();">
									</select>
								</td>
							</tr>
							<tr>
								<th><fmt:message key="dtl_cont"/></th>
								<td colspan="7">
									<input type="text" id="note" name="note" style="width:848px;"/>
								</td>
							</tr>
						</table>
					</div>
					<%@ include file="../include/hncis_message.gas"%>
				</div>
			</div>
		</form>
		<form id="hideForm" name="hideForm" method="post">
			<input type="hidden" id="hid_csrfToken" name="hid_csrfToken">
		</form>
		<img id="loading_progress_img" src="<%=ctxPath %>/images/common/progress_bar.gif" width="362" height="131" style="display:none" />
	</div>
</html>

<script type="text/javascript">
	var datarow1 = {room_place:"",day_num:"",day_name:"",pop_img:"",new_write_key:""
		,tm0000:"",tm0030:"",tm0100:"",tm0130:"",tm0200:"",tm0230:"",tm0300:"",tm0330:"",tm0400:"",tm0430:"",tm0500:"",tm0530:"",tm0600:"",tm0630:""
		,tm0700:"",tm0730:"",tm0800:"",tm0830:"",tm0900:"",tm0930:"",tm1000:"",tm1030:"",tm1100:"",tm1130:"",tm1200:"",tm1230:"",tm1300:"",tm1330:""
		,tm1400:"",tm1430:"",tm1500:"",tm1530:"",tm1600:"",tm1630:"",tm1700:"",tm1730:"",tm1800:"",tm1830:"",tm1900:"",tm1930:"",tm2000:"",tm2030:""
		,tm2100:"",tm2130:"",tm2200:"",tm2230:"",tm2300:"",tm2330:""
		,tm0000_yn:"",tm0030_yn:"",tm0100_yn:"",tm0130_yn:"",tm0200_yn:"",tm0230_yn:"",tm0300_yn:"",tm0330_yn:"",tm0400_yn:"",tm0430_yn:"",tm0500_yn:"",tm0530_yn:"",tm0600_yn:"",tm0630_yn:""
		,tm0700_yn:"",tm0730_yn:"",tm0800_yn:"",tm0830_yn:"",tm0900_yn:"",tm0930_yn:"",tm1000_yn:"",tm1030_yn:"",tm1100_yn:"",tm1130_yn:"",tm1200_yn:"",tm1230_yn:"",tm1300_yn:"",tm1330_yn:""
		,tm1400_yn:"",tm1430_yn:"",tm1500_yn:"",tm1530_yn:"",tm1600_yn:"",tm1630_yn:"",tm1700_yn:"",tm1730_yn:"",tm1800_yn:"",tm1830_yn:"",tm1900_yn:"",tm1930_yn:"",tm2000_yn:"",tm2030_yn:""
		,tm2100_yn:"",tm2130_yn:"",tm2200_yn:"",tm2230_yn:"",tm2300_yn:"",tm2330_yn:""
	};

	var cn1 =['<fmt:message key="mt_rm"/>','',
	          '00','30','00','30','00','30','00','30','00','30','00','30','00','30','00','30','00','30','00','30'
	         ,'00','30','00','30','00','30','00','30','00','30','00','30','00','30','00','30','00','30','00','30'
	         ,'00','30','00','30','00','30','00','30'
	         ,'','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','',''
	];
	var cm1 = [
	  		{name:'room_place',index:'room_place', formatter:'string',width:180,align:'left',editable:false,sortable:false},
	  		{name:'new_write_key',index:'new_write_key', formatter:'string',width:20,sortable:false, align:'center', hidden:true},
	  		{name:'tm0000',index:'tm0000', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0030',index:'tm0030', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0100',index:'tm0100', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0130',index:'tm0130', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0200',index:'tm0200', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0230',index:'tm0230', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0300',index:'tm0300', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0330',index:'tm0330', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0400',index:'tm0400', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0430',index:'tm0430', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0500',index:'tm0500', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0530',index:'tm0530', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0600',index:'tm0600', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0630',index:'tm0630', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0700',index:'tm0700', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0730',index:'tm0730', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0800',index:'tm0800', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0830',index:'tm0830', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0900',index:'tm0900', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0930',index:'tm0930', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1000',index:'tm1000', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1030',index:'tm1030', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1100',index:'tm1100', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1130',index:'tm1130', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1200',index:'tm1200', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1230',index:'tm1230', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1300',index:'tm1300', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1330',index:'tm1330', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1400',index:'tm1400', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1430',index:'tm1430', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1500',index:'tm1500', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1530',index:'tm1530', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1600',index:'tm1600', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1630',index:'tm1630', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1700',index:'tm1700', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1730',index:'tm1730', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1800',index:'tm1800', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1830',index:'tm1830', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1900',index:'tm1900', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm1930',index:'tm1930', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2000',index:'tm2000', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2030',index:'tm2030', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2100',index:'tm2100', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2130',index:'tm2130', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2200',index:'tm2200', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2230',index:'tm2230', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2300',index:'tm2300', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm2330',index:'tm2330', formatter:'string',width:15,editable:false,sortable:false},
	  		{name:'tm0000_yn',index:'tm0000_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0030_yn',index:'tm0030_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0100_yn',index:'tm0100_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0130_yn',index:'tm0130_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0200_yn',index:'tm0200_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0230_yn',index:'tm0230_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0300_yn',index:'tm0300_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0330_yn',index:'tm0330_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0400_yn',index:'tm0400_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0430_yn',index:'tm0430_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0500_yn',index:'tm0500_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0530_yn',index:'tm0530_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0600_yn',index:'tm0600_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0630_yn',index:'tm0630_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0700_yn',index:'tm0700_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0730_yn',index:'tm0730_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0800_yn',index:'tm0800_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0830_yn',index:'tm0830_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0900_yn',index:'tm0900_yn',width:0,editable:false,hidden:true},
	  		{name:'tm0930_yn',index:'tm0930_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1000_yn',index:'tm1000_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1030_yn',index:'tm1030_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1100_yn',index:'tm1100_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1130_yn',index:'tm1130_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1200_yn',index:'tm1200_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1230_yn',index:'tm1230_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1300_yn',index:'tm1300_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1330_yn',index:'tm1330_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1400_yn',index:'tm1400_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1430_yn',index:'tm1430_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1500_yn',index:'tm1500_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1530_yn',index:'tm1530_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1600_yn',index:'tm1600_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1630_yn',index:'tm1630_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1700_yn',index:'tm1700_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1730_yn',index:'tm1730_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1800_yn',index:'tm1800_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1830_yn',index:'tm1830_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1900_yn',index:'tm1900_yn',width:0,editable:false,hidden:true},
	  		{name:'tm1930_yn',index:'tm1930_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2000_yn',index:'tm2000_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2030_yn',index:'tm2030_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2100_yn',index:'tm2100_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2130_yn',index:'tm2130_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2200_yn',index:'tm2200_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2230_yn',index:'tm2230_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2300_yn',index:'tm2300_yn',width:0,editable:false,hidden:true},
	  		{name:'tm2330_yn',index:'tm2330_yn',width:0,editable:false,hidden:true}
	];

	var firstYn = "Y";
	var authType = "N";

	function fnSetDocumentReady(){
		$("#req_ymd").datepicker({
			dateFormat: "yy-mm-dd"
				,onSelect: function (dateText, inst) {
					setFormClear();
					doSearchList("N");
				}
		});

		$("#fr_ymd").datepicker({
			dateFormat: "yy-mm-dd"
				,onSelect: function (dateText, inst) {
					fn_changeFrYmd();
					fnChkApplyReqsYmd();
				}
		});

		$("#to_ymd").datepicker({ 
			dateFormat: "yy-mm-dd"
				,onSelect: function (dateText, inst) {
					fnChkApplyReqsYmd();
				}
				,beforeShowDay: noBeforeToYmd
		});

		$("#isMulti").change(function(){
			longTermCheck();
		});

		//공통 콤보 조회
		getCommonCode("key_room_plant:X0004;room_plant:X0004;fr_time:TIME;to_time:TIME;budget_type:X3012;tot:X3020;rsvt_day:XRM02:A", "N", "searchRoomAuthInfo();");
	}

	function noBeforeToYmd(date){
		var ymd = getAddDayDate($("#fr_ymd").val().replace(/-/gi,""), -1)
		var d = new Date(ymd.substr(0,4) + "-" + ymd.substr(4,2) + "-" + ymd.substr(6,2));
	    if (date <= d)
	        return [false];
	    return [true];
	}

	// 회의실 담당자 조회
	function searchRoomAuthInfo(){
		var keyData = {
			admin_id : sess_empno,
			corp_cd	 : sess_corp_cd
		};
		
		paramData = {
			paramJson 			: util.jsonToString(keyData)
		};
		
		doCommonAjax("doSearchRmToRoomAuthInfo.do", paramData,"roomAuthCallBack(jsonData.sendResult);");
	}

	function roomAuthCallBack(result){
		// 권한에 따른 제어
		if($("#work_auth").val() < 5 && sess_mstu != "M"){
			readOnlyStyle("req_eeno", 1);
			readOnlyStyle("snb_rson_sbc", 1);
			authType = "N";
			if(result.room_code != ""){
				authType = result.room_code;
			}
			else{
				authType = "N";
			}

			//$("#room_plant").attr("disabled", true);
			//$("#room_plant").val(sess_plac_work);
		}else{
			readOnlyStyle("req_eeno", 2);
			readOnlyStyle("snb_rson_sbc", 2);
			authType = "Y";
		}

		searchRoomPlaceComb();
	}

	function searchRoomPlaceComb(){
		if($('#room_plant').val() == "2"){
			$(".plant_hidden_area").hide();
		}else{
			$(".plant_hidden_area").show();
		}

		var params = {
			room_plant		: $('#room_plant').val(),
			mode			: 'S',
			auth_type		: authType,
			admin_id		: sess_empno,
			corp_cd			: sess_corp_cd
		};
		
		doCommonAjax("doSearchRmToMultiComboPlant.do", params,"plantComboCallBack(jsonData);");
	}

	function plantComboCallBack(jsonData){
		$.each(eval(jsonData.sendResult),function(targetNm,optionData){
			$("#room_place").loadSelect(eval(optionData));
		});

		if(firstYn == "Y"){
			if($("#M_REQ_YMD").val().length == 8){
				var reqYmd = $("#M_REQ_YMD").val().substring(0, 4) + "-" + $("#M_REQ_YMD").val().substring(4, 6) + "-" + $("#M_REQ_YMD").val().substring(6, 8);
				$("#req_ymd").val(reqYmd);
			}

			firstYn = "N";
			init();
		}else{
			doSearchList("N");
		}
	}

	function init(){
		var params = {
				sply_ymd	: selectNum($("#req_ymd").val()),
				room_plant	: $('#room_plant').val(),
				auth_type	: authType,
				admin_id	: sess_empno,
				corp_cd		: sess_corp_cd,
				loc_cd		: sess_locale
		};

		var flag = "N";
		if($('#M_DOC_NO').val() != ""){
			flag = "Y";
		}

		gridParam = {
			viewEdit : [{
				gridName     : "htmlTable",
				url          : "doSearchGridRmToReqList.do",
				colNames     : cn1,
				colModel     : cm1,
				height       : "100%",
				sortname     : "car_nm",
				sortorder    : "desc",
				rownumbers   : false,
				multiselect  : false,
				cellEdit     : true,
				fnMerge      : false,
				scroll: false,
				rowNum: 31,
				paramJson    : params,
				dblClickRowFc : "celldbClickAction(rowId,iRow,iCol,e);",
				completeFc	 	: "fnInitGridComplete();doSearchListCallBack('" + flag + "');"
			}]
		};

		commonJqGridInit(gridParam, "N");

		// 조회페이지에서 호출할경우
		//fnChkApplyReqsObjects();
	}

	function fnInitGridComplete(){
		jQuery("#htmlTable").jqGrid('setGroupHeaders', {
			useColSpanStyle: true,
			groupHeaders:[
	          {startColumnName: 'tm0000', numberOfColumns: 2, titleText: '00'},
	          {startColumnName: 'tm0100', numberOfColumns: 2, titleText: '01'},
	          {startColumnName: 'tm0200', numberOfColumns: 2, titleText: '02'},
	          {startColumnName: 'tm0300', numberOfColumns: 2, titleText: '03'},
	          {startColumnName: 'tm0400', numberOfColumns: 2, titleText: '04'},
	          {startColumnName: 'tm0500', numberOfColumns: 2, titleText: '05'},
	          {startColumnName: 'tm0600', numberOfColumns: 2, titleText: '06'},
	          {startColumnName: 'tm0700', numberOfColumns: 2, titleText: '07'},
	          {startColumnName: 'tm0800', numberOfColumns: 2, titleText: '08'},
	          {startColumnName: 'tm0900', numberOfColumns: 2, titleText: '09'},
	          {startColumnName: 'tm1000', numberOfColumns: 2, titleText: '10'},
	          {startColumnName: 'tm1100', numberOfColumns: 2, titleText: '11'},
	          {startColumnName: 'tm1200', numberOfColumns: 2, titleText: '12'},
	          {startColumnName: 'tm1300', numberOfColumns: 2, titleText: '13'},
	          {startColumnName: 'tm1400', numberOfColumns: 2, titleText: '14'},
	          {startColumnName: 'tm1500', numberOfColumns: 2, titleText: '15'},
	          {startColumnName: 'tm1600', numberOfColumns: 2, titleText: '16'},
	          {startColumnName: 'tm1700', numberOfColumns: 2, titleText: '17'},
	          {startColumnName: 'tm1800', numberOfColumns: 2, titleText: '18'},
	          {startColumnName: 'tm1900', numberOfColumns: 2, titleText: '19'},
	          {startColumnName: 'tm2000', numberOfColumns: 2, titleText: '20'},
	          {startColumnName: 'tm2100', numberOfColumns: 2, titleText: '21'},
	          {startColumnName: 'tm2200', numberOfColumns: 2, titleText: '22'},
	          {startColumnName: 'tm2300', numberOfColumns: 2, titleText: '23'}
	        ]
		});

		initAfterMenus();

		setInitUserInfo();
	}

	function setChangeImg(){

		var gridId = jQuery('#htmlTable').jqGrid('getDataIDs');
		for(var i = 1 ; i <= gridId.length ; i++){
			var imgSrc = "<img src='../../images/bttn/find-f.gif' onClick='doPopImgOpen();'/>";
			jQuery('#htmlTable').jqGrid("setRowData", i, {pop_img:imgSrc});

		}
	}

	function celldbClickAction(rowId,iRow,iCol,e){
		var hid_doc_no = $("#htmlTable").getCell(rowId,iCol+48);
		if(jQuery.trim(hid_doc_no) != ""){
			$('#M_DOC_NO').val(hid_doc_no);
			doSearch();
		}
	}

	function addRow1(){
		var gridRowId = jQuery("#htmlTable").getDataIDs().length;
		for(var i = 1; i <= 10 - gridRowId ; i++){
			jQuery("#htmlTable").jqGrid("addRowData", gridRowId+i, datarow1);
		}

	}

	//유저정보 세팅
	function setInitUserInfo(){
		$("#eeno").val(sess_empno);
		$("#eeno_nm").val(sess_name);
		$("#pos_nm").val(sess_step_name);
		$("#dept_nm").val(sess_dept_name);
		$("#ptt_ymd").val(getCurrentToDateAddDayEn("/",0));
		$("#tel_no").val(sess_tel_no);
	}

	function retrieve(btnFlag){
		var f = document.frm;
		switch(btnFlag){
		   case "search" :
			    doSearchList("N");
				break;
		   case "save" :
			   doSave();
				break;
		   case "edit" :
			    doModify();
			    break;
		   case "delete" :
			    doDelete();
				break;
		   case "request" :
			    doApprove();
				break;
		   case "requestCancel" :
			    doApproveCancel();
				break;
		   case "back" :
			    doBack();
			    break;
		   case "new" :
			    doNew();
			    break;
		}
	}


	function doSave(){

		//데이터 수정일때 권한 체크
		if($("#doc_no").val() != ""){
			//일반사용자 일때 체크
			if($("#work_auth").val() < 5 && sess_mstu != "M" && authType.indexOf($("#room_place_h").val()) == -1){
				//입력자 본인이지 체크
				if(sess_empno != $("#ipe_eeno").val()){
					alertUI('<fmt:message key="MSG.STAT.0015"/>');
					return;
				};
				//입력 상태인지 체크
				if($("#pgs_st_cd").val() != '0'){
					alertUI('<fmt:message key="MSG.STAT.0002"/>');
					return;
				}
			}
		}

		if($("#pgs_st_cd").val() == '2'){
			alertUI('<fmt:message key="MSG.STAT.0002"/>');
			return;
		}

		if($("#req_ymd").val() == ""){
			alertUI('<fmt:message key="MSG.INP.0051"/>');
			$("#req_ymd").focus();
			return;
		}

		if($("#room_plant").val() == ""){
			alertUI('<fmt:message key="MSG.SEL.0008"/>');
			$("#room_plant").focus();
			return;
		}

		if($("#req_eeno").val().length != 8){
			alertUI('<fmt:message key="MSG.INP.0010"/>');
			$("#req_eeno").focus();
			return;
		}

		if($("#room_place").val() == ""){
			alertUI('<fmt:message key="MSG.SEL.0007"/>');
			$("#room_place").focus();
			return;
		}

		if($("#fr_ymd").val() == ""){
			alertUI('<fmt:message key="MSG.INP.0020"/>');
			$("#fr_ymd").focus();
			return;
		}

		if($("#fr_time").val() == ""){
			alertUI('<fmt:message key="MSG.SEL.0005"/>');
			$("#fr_time").focus();
			return;
		}

		if($("#to_ymd").val() == ""){
			alertUI('<fmt:message key="MSG.INP.0021"/>');
			$("#to_ymd").focus();
			return;
		}

		if($("#to_time").val() == ""){
			alertUI('<fmt:message key="MSG.SEL.0006"/>');
			$("#to_time").focus();
			return;
		}

		if(selectNum($("#fr_ymd").val()) > selectNum($("#to_ymd").val())){
			alertUI('<fmt:message key="MSG.VAL.0001"/>');
			return;
		}

		if($("#fr_time").val() >= $("#to_time").val()){
			alertUI('<fmt:message key="MSG.VAL.0001"/>');
			return;
		}


		if(selectNum($("#fr_ymd").val()) < selectNum($("#yymmdd").val())){
			alertUI('<fmt:message key="MSG.VAL.0026"/>');
			return;
		}

		var timSbc = setTimeSbc();

		var chkFlag = "N";
		if($('input:checkbox[name=isMulti]').is(':checked')){
			chkFlag = "Y";
		}

		var keyData = {
				doc_no				: $("#doc_no").val(),
				room_plant      	: $("#room_plant").val(),
				room_place      	: $("#room_place").val(),
				ptt_ymd      		: selectNum($("#ptt_ymd").val()),
				fr_ymd      		: selectNum($("#fr_ymd").val()),
				to_ymd      		: selectNum($("#to_ymd").val()),
				fr_time      		: $("#fr_time").val(),
				to_time      		: $("#to_time").val(),
				note      			: $("#note").val(),
				pgs_st_cd			: '0',
				dept_cd				: sess_dept_code,
				ipe_eeno			: sess_empno,
				updr_eeno			: sess_empno,
				tim_info_sbc		: timSbc,
				req_eeno			: $("#req_eeno").val(),
				room_place_h      	: $("#room_place_h").val(),
				auth_type      		: authType,
				rsvt_day			: $("#rsvt_day").val(),
				chkFlag				: chkFlag,
				corp_cd				: sess_corp_cd
		};

		confirmUI('<fmt:message key="MSG.CNF.0004"/>');
		$("#pop_yes").click(function(){
			$.unblockUI({
				onUnblock: function(){
					var paramData = {
							paramJson 			: util.jsonToString(keyData)
						};
						doCommonAjax("doSaveRmToRequest.do", paramData, "setBottomMsg(jsonData.sendResult.message, true);saveCallBack(jsonData.sendResult);");
				}
			});
		});
	}
	function saveCallBack(result){

		if(result.code1 == "Y"){
			$("#M_DOC_NO").val(result.code);
			doSearchList("Y");
		}
	}

	function doDelete(){
		
		if(!processFlag("delete")) return;

		//데이터 수정일때 권한 체크
		if($("#doc_no").val() != ""){
			//일반사용자 일때 체크
			if($("#work_auth").val() < 5 && sess_mstu != "M"){
				//입력자 본인이지 체크
				if(sess_empno != $("#ipe_eeno").val()){
					alertUI('<fmt:message key="MSG.STAT.0016"/>');
					return;
				};
				//입력 상태인지 체크
				if($("#pgs_st_cd").val() != '0'){
					alertUI('<fmt:message key="MSG.STAT.0003"/>');
					return;
				}
			}
		}

		if($("#pgs_st_cd").val() != '0'){
			alertUI('<fmt:message key="MSG.STAT.0003"/>');
			return;
		}


		var keyData = {
				doc_no				: $("#doc_no").val(),
				eeno				: $("#eeno").val(),
				corp_cd				: sess_corp_cd
		};

		confirmUI('<fmt:message key="MSG.CNF.0002"/>');
		$("#pop_yes").click(function(){
			$.unblockUI({
				onUnblock: function(){
					var paramData = {
							paramJson 			: util.jsonToString(keyData)
						};
						doCommonAjax("doDeleteRmToRequest.do", paramData, "setBottomMsg(jsonData.sendResult.message, true);deleteCallBack(jsonData.sendResult);");
				}
			});
		});
	}
	function deleteCallBack(result){
		$("#budget_type").val("");
		$("#budget_no").val("");
		$("#budget_ipt").val("");
		$("#budget_no").attr("style", "display:none;");
		$("#budget_ipt").attr("style", "display:none;");

		if(result.code1 == "Y"){
			doSearchList("Y");
		}
	}

	function setTimeSbc(){

		var tm_sbc = "";
		var tm_arr = ["0000","0030","0100","0130","0200","0230","0300","0330","0400","0430","0500","0530","0600","0630"
		              ,"0700","0730","0800","0830","0900","0930","1000","1030","1100","1130","1200","1230","1300","1330"
		              ,"1400","1430","1500","1530","1600","1630","1700","1730","1800","1830","1900","1930","2000","2030"
		              ,"2100","2130","2200","2230","2300","2330","2400"];
		var strYn = "N";
		for(var i = 0 ; i < 48 ; i++){
			if($("#fr_time").val() == tm_arr[i]){
				strYn = "Y";
			}

			if($("#to_time").val() == tm_arr[i]){
				strYn = "N";
			}
			tm_sbc = tm_sbc + strYn;
		}
		return tm_sbc;
	}


	function doSearch(msgFlag){
		setFormClear();

		var keyData = {
				doc_no  : $('#M_DOC_NO').val(),
				eeno    : sess_empno,
				corp_cd	: sess_corp_cd,
				loc_cd  : sess_locale
		};
		paramData = {
				paramJson      	: util.jsonToString(keyData)
		};
		doCommonAjax("doSearchInfoRmToRequest.do", paramData, "loadCallBack(jsonData.sendResult,'"+msgFlag+"');");
	}

	/**
	 * callback
	 */
	function loadCallBack(result,msgFlag){
		loadJsonSet(result);

		$("#eeno").val(result.req_eeno);
		$("#eeno_nm").val(result.req_eeno_nm);
		$("#pos_nm").val(result.req_step_nm);
		$("#dept_nm").val(result.req_dept_nm);
		$("#ptt_ymd").val(result.ptt_ymd);
		$("#tel_no").val(result.req_tel_no);
		$("#pgs_st_nm").val(result.pgs_st_nm);

		$("#rsvt_day").val(result.rsvt_day);
		
		if(msgFlag != 'N'){
			setBottomMsg(result.message, false);
		}

		if($('#room_plant').val() == "2"){
			$(".plant_hidden_area").hide();
		}else{
			$(".plant_hidden_area").show();
		}

		if(result.fr_ymd != result.to_ymd || result.rsvt_day != ""){
			$("#isMulti").attr('checked', true) ;
		}else{
			$("#isMulti").attr('checked', false) ;
		}
		
		longTermCheck();

		fnChkApplyReqsYmd();
	}

	function changePlaceComb(){
		if($("#work_auth").val() == 5 || sess_mstu == "M" || authType.indexOf($("#room_place").val()) > -1){
		
		}else{
			longTermCheck();
		}
	}

	function doSearchList(sFlag){
		params = {
				sply_ymd	: selectNum($("#req_ymd").val()),
				room_plant	: $('#room_plant').val(),
				auth_type	: authType,
				admin_id	: sess_empno,
				corp_cd		: sess_corp_cd,
				loc_cd		: sess_locale,
				locale		: $("#lo").val()
		};

		doCommonSearch("doSearchGridRmToReqList.do", util.jsonToString(params), "doSearchListCallBack('"+sFlag+"');", "htmlTable","");
	}

	function doSearchListCallBack(sFlag){
		var gridId = jQuery('#htmlTable').jqGrid('getDataIDs');
		for(var i = 1 ; i <= gridId.length ; i++){
			for(var n = 50 ; n < 98 ; n++){

				var colVal = jQuery("#htmlTable").getCell(i,n);

				if(colVal != ''){

					var valArr = colVal.split('/,/');
					var cm = jQuery("#htmlTable").jqGrid('getGridParam', 'colModel');
					$("#htmlTable").setCell(i,cm[n-48].name,' ', {background:valArr[0]},{'title':valArr[1]});
					$("#htmlTable").setCell(i,cm[n].name,valArr[2]);
				}
			}
		}

		if(sFlag == "Y"){
			doSearch();
		}else{
			longTermCheck();
		}
		
	}

	function doApprove(){
		
		if(!processFlag("request")) return;

		if($("#ipe_eeno").val() != sess_empno && !(sess_mstu == "M" || sess_auth > 4)){
			alertUI('<fmt:message key="MSG.STAT.0038"/>');
			return;
		}
		if($("#pgs_st_cd").val() != '0'){
			alertUI('<fmt:message key="MSG.STAT.0005"/>');
			return;
		}

		if($("#room_plant").val() != "2"){
			if($("#room_meal_h").val() == 'N'){
				alertUI('<fmt:message key="MSG.SEL.0018"/>');
				return;
			}
		}

		if(selectNum($("#fr_ymd").val()) < selectNum($("#yymmdd").val())){
			alertUI('<fmt:message key="MSG.VAL.0065"/>');
			return;
		}
		
		var ids = jQuery("#htmlTable").getDataIDs();
		var vstParams = [];
		var keyData = {
			doc_no			: $("#doc_no").val(),
			pgs_st_cd		: '3',
			eeno			: $("#req_eeno").val(),
			updr_eeno 		: sess_empno,
			corp_cd			: sess_corp_cd
		};

		fnStartLoading();

		confirmUI('<fmt:message key="MSG.CNF.0005"/>');
		$("#pop_yes").click(function(){
			$.unblockUI({
				onUnblock: function(){
					var paramData = {
							paramJson : util.jsonToString(keyData)
					};
					doCommonAjax("doApproveRmToRequest.do", paramData, "actionCallBack(jsonData.sendResult);");
				}
			});
		});
	}

	function doApproveCancel(){
		
		if(!processFlag("requestCancel")) return;
		
		if($("#pgs_st_cd").val() != '3'){
			alertUI('<fmt:message key="MSG.STAT.0006"/>');
			return;
		}
		
		//작성 중인 사람이 아닌 경우에는 cancel할 수 없음.
		if($("#ipe_eeno").val() != sess_empno && !(sess_mstu == "M" || sess_auth > 4)){
			alertUI('<fmt:message key="MSG.STAT.0019"/>');
			return;
		}
		
		var keyData = {
			pgs_st_cd		: '0',
			updr_eeno		: sess_empno,
			doc_no			: $("#doc_no").val(),
			corp_cd			: sess_corp_cd
		};

		fnStartLoading();

		confirmUI('<fmt:message key="MSG.CNF.0006"/>');
		$("#pop_yes").click(function(){
			$.unblockUI({
				onUnblock: function(){
					var paramData = {
							paramJson : util.jsonToString(keyData)
						};
						doCommonAjax("doApproveCancelRmToRequest.do", paramData, "actionCallBack(jsonData.sendResult);");
				}
			});
		});
	}

	function actionCallBack(result){
		fnEndLoading();
		setBottomMsg(result.message, true);
		doSearch('N');
	}

	//Form Clear
	function setFormClear(){
		$('#room_place').val("");
		$('#fr_ymd').val($('#req_ymd').val());
		$('#fr_time').val("");
		$('#to_ymd').val($('#req_ymd').val());
		$('#to_time').val("");
		$('#note').val("");

		$("#req_eeno").val(sess_empno);
		$("#eeno_nm").val(sess_name);
		$("#pos_nm").val(sess_step_name);
		$("#dept_nm").val(sess_dept_name);
		$("#ptt_ymd").val(getCurrentToDateAddDayEn("/",0));
		$("#doc_no").val("");
		$("#tel_no").val(sess_tel_no);
		$("#pgs_st_nm").val("");

		$("#isMulti").attr('checked', false) ;
		$("#to_ymd").attr("disabled", false);
		$("#fr_time").attr("disabled", false);
		$("#to_time").attr("disabled", false);

		$("#snb_rson_sbc").val("");
	}

	//Insa Search
	function cearInsa(){
		if($("#req_eeno").val() == ""){
			$("#req_eeno").val("");
			$("#eeno_nm").val("");
			$("#pos_nm").val("");
			$("#dept_nm").val("");
			$("#tel_no").val("");
		}
	}

	function setInsaInfo(){
		if($("#req_eeno").val() != ""){
			var keyData = {
					xusr_empno : $("#req_eeno").val(),
					corp_cd		: sess_corp_cd
			};
			paramData = {
				paramJson : util.jsonToString(keyData)
			};
			doCommonAjax("/doSearchToUserInfo.do", paramData, "insaCallBack(jsonData.sendResult)");
		}
	}

	function doNew(){
		$("#req_ymd").val(getCurrentToDateEn("en"));
		 setFormClear();
	     doSearchList("N");
	}

	/**
	 * callback
	 */
	function insaCallBack(result){
// 		$("#req_eeno").val(result.xusr_empno);
		$("#eeno_nm").val(result.xusr_name);
		$("#pos_nm").val(result.xusr_step_name);
		$("#dept_nm").val(result.xusr_dept_name);
		$("#tel_no").val(result.xusr_tel_no);

	}

	function doBack(){
	    var form = $("<form/>");
	    form.attr("method" , "post");
	    form.attr("id"     , "submitForm").attr("name", "submitForm");
	    form.attr("action" , $("#hid_view_nm").val() + ".gas");
	    var inp1 = $("<input type='hidden' id='hid_cond' name='hid_cond'/>").val($("#hid_cond").val());
	    var token = $("<input type='hidden' id='hid_csrfToken' name='hid_csrfToken'/>").val($("#csrfToken").val());
	    form.append(inp1, token);
	    $("body").append(form);
	    form.submit();
	    form.remove();
	}

	function fn_changeFrYmd(){
		if(!$('input:checkbox[name=isMulti]').is(':checked')){
			$("#to_ymd").val($("#fr_ymd").val());
		}else{
			if($("#fr_ymd").val() > $("#to_ymd").val()){
				$("#to_ymd").val($("#fr_ymd").val());
			}  
		}
	}

	function longTermCheck(){
		if(!$("#isMulti").is(":checked")){
			$("#to_ymd").val($("#fr_ymd").val());
			$("#to_ymd").attr("disabled", true);
			$("#fr_time").attr("disabled", false);
			$("#to_time").attr("disabled", false);

			$("#rsvt_day").val("");
			$("#rsvt_day").attr("disabled", true);
		}else{
			$("#rsvt_day").attr("disabled", false);

			if($("#rsvt_day").val() == ""){
				$("#to_ymd").attr("disabled", false);
			}else{
				$("#to_ymd").attr("disabled", false);

				$("#fr_time").attr("disabled", false);
				$("#to_time").attr("disabled", false);
			}
		}

		if($("#to_ymd").val() == $("#fr_ymd").val() && $("#fr_time").val() >= $("#to_time").val()){
			$("#tr_nm2").removeClass("req-color-after").addClass("req-color");
			if($("#room_place").val() == ""){
				$("#tr_nm1").removeClass("req-color-after").addClass("req-color");
			}
		}else{
			fnChkApplyReqsObjects();
		}  
	}

	function CheckValue(strValue) {
		var strReg = /^[A-Za-z0-9]+$/;
		if (!strReg.test(strValue)){
			$("#budget_ipt").val(strValue.substring(0,strValue.length -1));
		}
	}

	function pageStepHelpPopup(){
		if(popup != null ){
			popup.close();
		}

		popup = popUpWindow3($("#help_url").val());
	}
	
	function fnChkApplyReqsYmd(){
		if($("#to_ymd").val() == $("#fr_ymd").val()){
			if($("#fr_time").val() >= $("#to_time").val()){
				$("#tr_nm2").removeClass("req-color-after").addClass("req-color");
			}else{
				$("#tr_nm2").removeClass("req-color").addClass("req-color-after");
			}
		}else{
			if($("#fr_time").val() >= $("#to_time").val()){
				$("#tr_nm2").removeClass("req-color-after").addClass("req-color");
			}else{
				$("#tr_nm2").removeClass("req-color").addClass("req-color-after");
			}
		}  
	}
	
	function processFlag(gubun){
		if(gubun != "save"){
			if($("#doc_no").val() == ""){
				alertUI('<fmt:message key="MSG.STAT.0047"/>');
				return;
			}
		}
		return true;
	}
</script>