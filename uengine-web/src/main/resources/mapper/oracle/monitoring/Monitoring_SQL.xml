<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="monitoring">
     
    <select id="selectNewWorkStatus" resultType="MonitoringVO">
        <![CDATA[
            SELECT 
			    TO_CHAR(INST.STARTEDDATE,'YYYY-MM-DD') AS STARTEDDATE,
				INST.DEFNAME,
				COUNT(1) AS TOTALCOUNT 
			FROM BPM_PROCINST INST
			INNER JOIN BPM_WORKLIST WL ON WL.INSTID = INST.INSTID
			WHERE INST.STATUS = 'RUNNING'
				AND INST.ISDELETED = 0
				AND INST.ISSUBPROCESS = 0
				AND WL.STATUS IN ('NEW','CONFIRMED','DRAFT')
				AND SYSDATE-7 <= INST.STARTEDDATE AND INST.STARTEDDATE <= SYSDATE-1 
			GROUP BY TO_CHAR(INST.STARTEDDATE,'YYYY-MM-DD'), INST.DEFNAME
        ]]>
    </select>
    <select id="selectProgressStatusByTask" resultType="MonitoringVO">
        <![CDATA[
          SELECT 
			INST.DEFNAME, 		
			COUNT(1) AS TOTALCOUNT 
		FROM BPM_PROCINST INST
		WHERE INST.STATUS = 'RUNNING'
			AND INST.ISDELETED = 0
			AND INST.ISSUBPROCESS = 0
		GROUP BY INST.DEFNAME;
        ]]>
    </select>
	<select id="selectProcessingDelayStatusByTask" resultType="MonitoringVO">
        <![CDATA[
          SELECT 
			INST.DEFNAME,
			NVL(COUNT(CASE WHEN DUEDATE <= FINISHEDDATE THEN 1 END),0) AS DELAYEDCOUNT
		FROM BPM_PROCINST INST
		INNER JOIN BPM_PROCDEF DEF ON INST.DEFID = DEF.DEFID 
		WHERE INST.STATUS = 'COMPLETED'
			AND INST.ISDELETED = 0
			AND INST.ISSUBPROCESS = 0
			AND DEF.OBJTYPE = 'PROCESS'
		GROUP BY INST.DEFNAME;
        ]]>
    </select>
     
</mapper>